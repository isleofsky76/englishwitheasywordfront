// 단어장 데이터 - 날짜별로 구성
const wordsByDate = {
    "20251021": {
  "title": "비행기 안에서 대화",
        "words": [
            
            {
        "word": "earplugs",
        "part_of_speech": "n",
        "korean_pronunciation": "이어플러그",
        "meaning": "귀마개",
        "example_sentence": "Excuse me, could I have a pair of earplugs, please?",
        "korean_translation": "실례지만 귀마개 한 쌍 주실 수 있을까요?",
        "sentence_pronunciation": "익스큐즈 미, 쿳 아이 해브 어 페어 오브 이어플러그스, 플리즈?",
         "key_words": ["earplugs"]
        },
        {
        "word": "blanket",
        "part_of_speech": "n",
        "korean_pronunciation": "블랭킷",
        "meaning": "담요",
        "example_sentence": "Could I get a blanket? It's a bit cold here.",
        "korean_translation": "담요 하나 주실 수 있을까요? 여기 조금 춥네요.",
        "sentence_pronunciation": "쿳 아이 겟 어 블랭킷? 잇츠 어 빗 콜드 히어.",
         "key_words": ["blanket"]
        },
        {
        "word": "sleeping mask",
        "part_of_speech": "n",
        "korean_pronunciation": "슬리핑 마스크",
        "meaning": "수면 안대",
        "example_sentence": "Do you have a sleeping mask available?",
        "korean_translation": "수면 안대가 있나요?",
        "sentence_pronunciation": "두 유 해브 어 슬리핑 마스크 어베일러블?",
         "key_words": ["sleeping mask"]
        },
        {
        "word": "sparkling water",
        "part_of_speech": "n",
        "korean_pronunciation": "스파클링 워터",
        "meaning": "탄산수",
        "example_sentence": "I'd like sparkling water, please.",
        "korean_translation": "탄산수로 부탁드립니다.",
        "sentence_pronunciation": "아이드 라이크 스파클링 워터, 플리즈.",
         "key_words": ["sparkling water"]
        },
        {
        "word": "still water",
        "part_of_speech": "n",
        "korean_pronunciation": "스틸 워터",
        "meaning": "생수, 탄산 없는 물",
        "example_sentence": "Could I get still water, please?",
        "korean_translation": "탄산 없는 생수 부탁드립니다.",
        "sentence_pronunciation": "쿳 아이 겟 스틸 워터, 플리즈?",
        "key_words": ["still water"]
        },
        {
        "word": "pillow",
        "part_of_speech": "n",
        "korean_pronunciation": "필로우",
        "meaning": "베개",
        "example_sentence": "Could I get an extra pillow, please?",
        "korean_translation": "베개 하나 더 받을 수 있을까요?",
        "sentence_pronunciation": "쿳 아이 겟 언 엑스트라 필로우, 플리즈?",
        "key_words": ["pillow"]
        },
        {
        "word": "bag",
        "part_of_speech": "n",
        "korean_pronunciation": "백",
        "meaning": "가방, 짐",
        "example_sentence": "Could you help me with my bag?",
        "korean_translation": "제 가방 좀 도와주실 수 있나요?",
        "sentence_pronunciation": "쿳 유 헬프 미 위드 마이 백?",
        "key_words": ["bag"]
        },
        {
        "word": "headphones",
        "part_of_speech": "n",
        "korean_pronunciation": "헤드폰스",
        "meaning": "헤드폰",
        "example_sentence": "Do you have any headphones available?",
        "korean_translation": "헤드폰 있나요?",
        "sentence_pronunciation": "두 유 해브 애니 헤드폰스 어베일러블?",
         "key_words": ["headphones"]
        },
        {
        "word": "assistance",
        "part_of_speech": "n",
        "korean_pronunciation": "어시스턴스",
        "meaning": "도움, 지원",
        "example_sentence": "I need some assistance with my seatbelt.",
        "korean_translation": "안전벨트 매는 것 좀 도와주세요.",
        "sentence_pronunciation": "아이 니드 썸 어시스턴스 위드 마이 싯벨트.",
        "key_words": ["assistance"]
        },
        {
        "word": "aisle",
        "part_of_speech": "n",
        "korean_pronunciation": "아일",
        "meaning": "통로",
        "example_sentence": "Excuse me, I need to get to the aisle.",
        "korean_translation": "실례합니다, 통로로 나가야 해요.",
        "sentence_pronunciation": "익스큐즈 미, 아이 니드 투 겟 투 디 아일.",
        "key_words": ["aisle"]
        },
        {
        "word": "overhead compartment",
        "part_of_speech": "n",
        "korean_pronunciation": "오버헤드 컴파트먼트",
        "meaning": "머리 위 짐칸",
        "example_sentence": "Please put your bag in the overhead compartment.",
        "korean_translation": "짐을 머리 위 짐칸에 넣어주세요.",
        "sentence_pronunciation": "플리즈 풋 유어 백 인 디 오버헤드 컴파트먼트.",
        "key_words": ["overhead compartment"]
        },
        {
        "word": "seat",
        "part_of_speech": "n",
        "korean_pronunciation": "싯",
        "meaning": "좌석",
        "example_sentence": "Is this seat taken?",
        "korean_translation": "이 좌석 사람 있나요?",
        "sentence_pronunciation": "이즈 디스 싯 테이큰?",
        "key_words": ["seat"]
        },
        {
        "word": "recline",
        "part_of_speech": "v",
        "korean_pronunciation": "리클라인",
        "meaning": "젖히다",
        "example_sentence": "May I recline my seat?",
        "korean_translation": "좌석을 뒤로 젖혀도 될까요?",
        "sentence_pronunciation": "메이 아이 리클라인 마이 싯?",
        "key_words": ["recline"]
        },
        {
        "word": "fasten",
        "part_of_speech": "v",
        "korean_pronunciation": "패슨",
        "meaning": "잠그다, 매다",
        "example_sentence": "Please fasten your seatbelt.",
        "korean_translation": "안전벨트를 매주세요.",
        "sentence_pronunciation": "플리즈 패슨 유어 싯벨트.",
        "key_words": ["fasten"]
        },
        {
        "word": "turbulence",
        "part_of_speech": "n",
        "korean_pronunciation": "터뷸런스",
        "meaning": "난기류, 흔들림",
        "example_sentence": "We're experiencing some turbulence.",
        "korean_translation": "난기류를 겪고 있습니다.",
        "sentence_pronunciation": "위어 익스피어리언싱 썸 터뷸런스.",
        "key_words": ["turbulence"]
        },
        {
        "word": "Refill",
        "part_of_speech": "n/v",
        "korean_pronunciation": "리필",
        "meaning": "다시 채우다, 리필하다",
        "example_sentence": "Could I have a refill of water, please?",
        "korean_translation": "물 한 번 더 리필해 주실 수 있나요?",
        "sentence_pronunciation": "쿳 아이 해브 어 리필 오브 워터, 플리즈?",
        "key_words": ["refill"]
        },
        {
        "word": "seatbelt sign",
        "part_of_speech": "n",
        "korean_pronunciation": "싯벨트 싸인",
        "meaning": "안전벨트 사인",
        "example_sentence": "Please remain seated while the seatbelt sign is on.",
        "korean_translation": "안전벨트 사인이 켜진 동안 자리에 앉아 계세요.",
        "sentence_pronunciation": "플리즈 리메인 시티드 와일 더 싯벨트 싸인 이즈 온.",
        "key_words": ["seatbelt sign"]
        },
        {
        "word": "landing",
        "part_of_speech": "n",
        "korean_pronunciation": "랜딩",
        "meaning": "착륙",
        "example_sentence": "We'll be landing in 10 minutes.",
        "korean_translation": "10분 후에 착륙합니다.",
        "sentence_pronunciation": "윌 비 랜딩 인 텐 미닛츠.",
        "key_words": ["landing"]
        },
        {
        "word": "tray table",
        "part_of_speech": "n",
        "korean_pronunciation": "트레이 테이블",
        "meaning": "식탁 받침대, 접이식 테이블",
        "example_sentence": "Please fold your tray table before landing.",
        "korean_translation": "착륙 전 트레이 테이블을 접어주세요.",
        "sentence_pronunciation": "플리즈 폴드 유어 트레이 테이블 비포 랜딩.",
        "key_words": ["tray table"]
        },
        {
        "word": "cabin crew",
        "part_of_speech": "n",
        "korean_pronunciation": "캐빈 크루",
        "meaning": "승무원",
        "example_sentence": "If you need assistance, please call the cabin crew.",
        "korean_translation": "도움이 필요하시면 승무원을 불러주세요.",
        "sentence_pronunciation": "이프 유 니드 어시스턴스, 플리즈 콜 더 캐빈 크루.",
        "key_words": ["cabin crew"]
        },
        {
        "word": "chicken",
        "part_of_speech": "n",
        "korean_pronunciation": "치킨",
        "meaning": "닭고기",
        "example_sentence": "Would you like chicken or beef?",
        "korean_translation": "닭고기 드시겠어요, 아니면 소고기 드시겠어요?",
        "sentence_pronunciation": "우쥬 라이크 치킨 오어 비프?",
        "key_words": ["chicken"]
        },
        {
        "word": "beef",
        "part_of_speech": "n",
        "korean_pronunciation": "비프",
        "meaning": "소고기",
        "example_sentence": "I'll have the beef, please.",
        "korean_translation": "소고기로 주세요.",
        "sentence_pronunciation": "아일 해브 더 비프, 플리즈.",
        "key_words": ["beef"]
        },
        {
        "word": "beverage",
        "part_of_speech": "n",
        "korean_pronunciation": "베버리지",
        "meaning": "음료",
        "example_sentence": "Would you like a beverage?",
        "korean_translation": "음료 드시겠어요?",
        "sentence_pronunciation": "우쥬 라이크 어 베버리지?",
        "key_words": ["beverage"]
        },
        {
        "word": "window seat",
        "part_of_speech": "n",
        "korean_pronunciation": "윈도우 싯",
        "meaning": "창가 좌석",
        "example_sentence": "I'd like to sit in the window seat.",
        "korean_translation": "창가 좌석에 앉고 싶습니다.",
        "sentence_pronunciation": "아이드 라이크 투 싯 인 더 윈도우 싯.",
        "key_words": ["window seat"]
        },
        {
        "word": "aisle seat",
        "part_of_speech": "n",
        "korean_pronunciation": "아일 싯",
        "meaning": "복도 좌석",
        "example_sentence": "Can I change to an aisle seat?",
        "korean_translation": "복도 좌석으로 바꿀 수 있나요?",
        "sentence_pronunciation": "캔 아이 체인지 투 언 아일 싯?",
        "key_words": ["aisle seat"]
        },
        {
        "word": "change",
        "part_of_speech": "v",
        "korean_pronunciation": "체인지",
        "meaning": "바꾸다, 변경하다",
        "example_sentence": "Can I change my seat?",
        "korean_translation": "제 좌석을 바꿀 수 있나요?",
        "sentence_pronunciation": "캔 아이 체인지 마이 싯?",
        "key_words": ["change"]
        },
        {
        "word": "digestive medicine",
        "part_of_speech": "n",
        "korean_pronunciation": "다이제스티브 메디슨",
        "meaning": "소화제",
        "example_sentence": "Do you have any digestive medicine?",
        "korean_translation": "소화제 있나요?",
        "sentence_pronunciation": "두 유 해브 애니 다이제스티브 메디슨?",
        "key_words": ["digestive medicine"]
        },
        {
        "word": "anti-diarrheal",
        "part_of_speech": "n",
        "korean_pronunciation": "안티 다이어리얼",
        "meaning": "지사제",
        "example_sentence": "I need some anti-diarrheal medicine.",
        "korean_translation": "지사제가 필요해요.",
        "sentence_pronunciation": "아이 니드 썸 안티 다이어리얼 메디슨.",
        "key_words": ["anti-diarrheal"]
        },
        {
        "word": "boarding pass",
        "part_of_speech": "n",
        "korean_pronunciation": "보딩 패스",
        "meaning": "탑승권",
        "example_sentence": "May I see your boarding pass?",
        "korean_translation": "탑승권을 보여주시겠어요?",
        "sentence_pronunciation": "메이 아이 씨 유어 보딩 패스?",
        "key_words": ["boarding pass"]
        },
         {
             "word": "unavailable",
             "part_of_speech": "adj",
             "korean_pronunciation": "언어베일러블",
             "meaning": "이용할 수 없는, 제공되지 않는",
             "example_sentence": "Some meals may be unavailable during the flight.",
             "korean_translation": "일부 식사는 비행 중 제공되지 않을 수도 있습니다.",
             "sentence_pronunciation": "썸 밀스 메이 비 언어베일러블 듀어링 더 플라잇.",
             "key_words": ["unavailable"]
           },
           {
             "word": "upright position",
             "part_of_speech": "n",
             "korean_pronunciation": "업라잇 포지션",
             "meaning": "직립 상태, 원위치",
             "example_sentence": "Please return your seat to the upright position.",
             "korean_translation": "좌석을 원위치로 되돌려 주세요.",
             "sentence_pronunciation": "플리즈 리턴 유어 싯 투 디 업라잇 포지션.",
             "key_words": ["upright position"]
           },
           {
             "word": "return",
             "part_of_speech": "v",
             "korean_pronunciation": "리턴",
             "meaning": "되돌리다, 반환하다",
             "example_sentence": "Please return your seat to its original position for landing.",
             "korean_translation": "착륙을 위해 좌석을 원위치로 되돌려 주세요.",
             "sentence_pronunciation": "플리즈 리턴 유어 싯 투 잇츠 오리지널 포지션 포 랜딩.",
             "key_words": ["return"]
           }
              
  ]
},



    
};

let currentWordIndex = 0;

// 키워드 하이라이트 함수
function highlightKeywords(text, keywords) {
    if (!keywords || keywords.length === 0) return text;
    
    let highlightedText = text;
    keywords.forEach(keyword => {
        const regex = new RegExp(`\\b${keyword}\\b`, 'gi');
        highlightedText = highlightedText.replace(regex, (match) => `<span style="color: red; font-weight: bold;">${match}</span>`);
    });
    return highlightedText;
}

// DOM 요소들
const wordContainer = document.getElementById('article-container');
const wordPopup = document.getElementById('wordPopup');
const popupWord = document.querySelector('.popup-word');
const popupMeaning = document.querySelector('.popup-meaning');
const popupClose = document.querySelector('.popup-close');

// 현재 날짜 설정 (YYYYMMDD 형식)
function getCurrentDate() {
    const now = new Date();
    const year = now.getFullYear();
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const day = String(now.getDate()).padStart(2, '0');
    return `${year}${month}${day}`;
}

// 현재 날짜의 단어들 가져오기
function getWordsForDate(date) {
    return wordsByDate[date]?.words || [];
}

// 현재 날짜의 제목 가져오기
function getTitleForDate(date) {
    return wordsByDate[date]?.title || `뉴스 단어 (${date})`;
}

// 사용 가능한 날짜 목록 가져오기 (최신 날짜부터)
function getAvailableDates() {
    return Object.keys(wordsByDate).sort().reverse();
}

// 모든 단어 표시 (모든 날짜를 아래로 쭉 나열)
function displayAllWords() {
    const availableDates = getAvailableDates();
    let allWordsHTML = '';
    
    availableDates.forEach(date => {
        const words = getWordsForDate(date);
        const title = getTitleForDate(date);
        let wordsText = '';
        
        if (words.length > 0) {
            words.forEach((word, index) => {
                const hasExample = word.example_sentence && word.korean_translation;
                const exampleId = `example-${date}-${index}`;
                const wordId = `word-${date}-${index}`;
                
                const partOfSpeech = word.part_of_speech ? ` <span style="color: #999; font-size: 0.85rem;">(${word.part_of_speech})</span>` : '';
                
                wordsText += `<div class="word-with-underline">
                    <span class="word-number">${index + 1}.</span> 
                    <span class="word-part">${word.meaning}</span> / 
                    <span class="word-part word-hideable" data-date="${date}" id="${wordId}-english">${word.word}${partOfSpeech}</span>
                    ${hasExample ? ` / <span class="example-toggle" onclick="toggleExample('${exampleId}')" style="color: #007bff; cursor: pointer; text-decoration: underline;">예문</span>` : ''}
                    ${hasExample ? `<div id="${exampleId}" class="example-content" style="display: none; padding-left: 2.0em; margin-top: 8px;">
                        <span class="word-part" style="white-space: nowrap;">${highlightKeywords(word.example_sentence, word.key_words || [])}</span>
                        <br><span class="word-part">(${word.korean_translation})</span>
                        ${word.sentence_pronunciation ? `<br><span class="word-part" style="color: #666; font-style: italic;">[${word.sentence_pronunciation}]</span>` : ''}
                    </div>` : ''}
                </div>`;
            });
            
            allWordsHTML += `
                <div class="words-title">
                    ${title}
                    <span id="toggle-all-${date}" onclick="toggleAllExamples('${date}')" style="color: #28a745; cursor: pointer; text-decoration: underline; font-size: 0.95rem; margin-left: 15px; font-weight: 500;">예문 펼치기</span>
                </div>
                <div class="words-text">${wordsText}</div>
                <div class="date-spacing"></div>
            `;
        }
    });
    
    wordContainer.innerHTML = allWordsHTML;
}

// 초기화
function init() {
    console.log("JavaScript가 로드되었습니다!");
    displayAllWords();
}

// 이벤트 리스너 등록
document.addEventListener('DOMContentLoaded', function() {
    // 단어장 초기화
    init();
    
    // Home 링크 클릭 이벤트
    const homeLink = document.querySelector('.nav-link[href="https://englisheasystudy.com/"]');
    if (homeLink) {
        homeLink.addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = 'https://englisheasystudy.com/';
        });
    }
    
    // 팝업 관련 이벤트
    if (popupClose) {
        popupClose.addEventListener('click', closePopup);
    }
    
    // 팝업 외부 클릭 시 닫기
    if (wordPopup) {
        wordPopup.addEventListener('click', function(e) {
            if (e.target === wordPopup) {
                closePopup();
            }
        });
    }
});

// 팝업 닫기
function closePopup() {
    if (wordPopup) {
        wordPopup.style.display = 'none';
    }
}

// 키보드 단축키
document.addEventListener('keydown', function(e) {
    // Escape로 팝업 닫기
    if (e.key === 'Escape') {
        closePopup();
    }
});

// 예문 토글 함수
function toggleExample(exampleId) {
    const exampleElement = document.getElementById(exampleId);
    if (exampleElement) {
        if (exampleElement.style.display === 'none') {
            exampleElement.style.display = 'block';
        } else {
            exampleElement.style.display = 'none';
        }
    }
}

// 단어 숨기기/보이기 토글 함수
function toggleWord(wordId) {
    const englishElement = document.getElementById(`${wordId}-english`);
    const koreanElement = document.getElementById(`${wordId}-korean`);
    
    if (englishElement && koreanElement) {
        if (englishElement.style.display === 'none') {
            // 단어 보이기
            englishElement.style.display = 'inline-block';
            koreanElement.style.display = 'inline-block';
        } else {
            // 단어 숨기기
            englishElement.style.display = 'none';
            koreanElement.style.display = 'none';
        }
    }
}

// 특정 날짜의 모든 단어 숨기기/보이기 토글 함수
function toggleAllWords(date) {
    const allWordsInDate = document.querySelectorAll(`.word-hideable[data-date="${date}"]`);
    
    if (allWordsInDate.length > 0) {
        const firstWord = allWordsInDate[0];
        const isHidden = firstWord.style.backgroundColor === 'white';
        
        allWordsInDate.forEach(wordElement => {
            if (isHidden) {
                // 모든 단어 보이기
                wordElement.style.backgroundColor = 'transparent';
                wordElement.style.color = '#1a1a1a';
            } else {
                // 모든 단어 흰색 배경으로 가리기
                wordElement.style.backgroundColor = 'white';
                wordElement.style.color = 'white';
            }
        });
    }
}

// 특정 날짜의 모든 예문 펼치기/닫기 토글 함수
function toggleAllExamples(date) {
    const allExamplesInDate = document.querySelectorAll(`[id^="example-${date}-"]`);
    const toggleButton = document.getElementById(`toggle-all-${date}`);
    
    if (allExamplesInDate.length > 0) {
        const firstExample = allExamplesInDate[0];
        const isHidden = firstExample.style.display === 'none' || firstExample.style.display === '';
        
        allExamplesInDate.forEach(exampleElement => {
            if (isHidden) {
                // 모든 예문 펼치기
                exampleElement.style.display = 'block';
            } else {
                // 모든 예문 닫기
                exampleElement.style.display = 'none';
            }
        });
        
        // 버튼 텍스트 변경
        if (toggleButton) {
            if (isHidden) {
                toggleButton.textContent = '예문 닫기';
                toggleButton.style.color = '#dc3545';
            } else {
                toggleButton.textContent = '예문 펼치기';
                toggleButton.style.color = '#28a745';
            }
        }
    }
}
