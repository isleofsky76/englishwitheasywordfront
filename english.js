/* Reset and Base Styles */// 단어장 데이터 - 날짜별로 구성
const wordsByDate = {
    "20251021": {
  "title": "월마트와 ChatGPT의 파트너십(20251021)",
  "words": [
   
    {
      "word": "monetize",
      "part_of_speech": "v",
      "korean_pronunciation": "머니타이즈",
      "meaning": "수익화하다",
      "example_sentence": "OpenAI is exploring ways to monetize ChatGPT’s massive user base.",
      "korean_translation": "오픈AI는 ChatGPT의 방대한 사용자 기반을 수익화할 방법을 모색하고 있다.",
      "key_words": ["monetize"]
    },
    {
      "word": "frictionless",
      "part_of_speech": "adj",
      "korean_pronunciation": "프릭션리스",
      "meaning": "마찰 없는, 매끄러운",
      "example_sentence": "Fast, frictionless shopping is every retailer’s dream.",
      "korean_translation": "빠르고 마찰 없는 쇼핑은 모든 소매업체의 꿈이다.",
      "key_words": ["frictionless"]
    },

    {
      "word": "loyalty",
      "part_of_speech": "n",
      "korean_pronunciation": "로열티",
      "meaning": "충성도, 충성심",
      "example_sentence": "Easy AI shopping could weaken customer loyalty to retailers.",
      "korean_translation": "AI 쇼핑의 편리함은 소매업체에 대한 고객 충성도를 약화시킬 수 있다.",
      "key_words": ["loyalty"]
    },
   
    {
      "word": "partnership",
      "part_of_speech": "n",
      "korean_pronunciation": "파트너십",
      "meaning": "협력, 제휴",
      "example_sentence": "Retailers announced new partnerships with ChatGPT to reach shoppers.",
      "korean_translation": "소매업체들은 소비자에게 다가가기 위해 ChatGPT와 새로운 협력을 발표했다.",
      "key_words": ["partnerships"]
    },
    {
      "word": "visibility",
      "part_of_speech": "n",
      "korean_pronunciation": "비저빌리티",
      "meaning": "가시성, 노출도",
      "example_sentence": "AI platforms give sellers visibility that traditional ads cannot match.",
      "korean_translation": "AI 플랫폼은 기존 광고로는 얻기 어려운 노출 효과를 판매자에게 제공한다.",
      "key_words": ["visibility"]
    },
    {
      "word": "dominance",
      "part_of_speech": "n",
      "korean_pronunciation": "도미넌스",
      "meaning": "지배, 우세",
      "example_sentence": "ChatGPT has established clear dominance among AI chatbots.",
      "korean_translation": "ChatGPT는 AI 챗봇들 중에서 확실한 지배적 위치를 차지했다.",
      "key_words": ["dominance"]
    },
    {
      "word": "upstream",
      "part_of_speech": "adv",
      "korean_pronunciation": "업스트림",
      "meaning": "상류에, 앞단계에",
      "example_sentence": "If discovery moves upstream to AI assistants, ad budgets may follow.",
      "korean_translation": "상품 검색이 AI 비서 쪽으로 이동한다면 광고 예산도 따라갈 수 있다.",
      "key_words": ["upstream"]
    },
    {
      "word": "adoption",
      "part_of_speech": "n",
      "korean_pronunciation": "어돕션",
      "meaning": "채택, 도입",
      "example_sentence": "Walmart’s move could accelerate GenAI adoption by other retailers.",
      "korean_translation": "Walmart의 결정은 다른 소매업체들의 생성형 AI 도입을 가속화할 수 있다.",
      "key_words": ["adoption"]
    },
    {
      "word": "profitability",
      "part_of_speech": "n",
      "korean_pronunciation": "프로피터빌리티",
      "meaning": "수익성",
      "example_sentence": "Retailers’ ad businesses have boosted their e-commerce profitability.",
      "korean_translation": "소매업체들의 광고 사업은 전자상거래의 수익성을 높였다.",
      "key_words": ["profitability"]
    },
    {
      "word": "comparison",
      "part_of_speech": "n",
      "korean_pronunciation": "컴패리즌",
      "meaning": "비교, 대조",
      "example_sentence": "Easy price comparisons could erode retailers’ pricing power.",
      "korean_translation": "가격 비교가 쉬워지면 소매업체의 가격 결정력이 약해질 수 있다.",
      "key_words": ["comparisons"]
    },
    {
      "word": "revenue",
      "part_of_speech": "n",
      "korean_pronunciation": "레버뉴",
      "meaning": "수익, 매출",
      "example_sentence": "Ad revenue makes up a growing share of retailers’ profits.",
      "korean_translation": "광고 수익은 소매업체 이익에서 점점 더 큰 비중을 차지하고 있다.",
      "key_words": ["revenue"]
    },
   
    {
      "word": "negotiate",
      "part_of_speech": "v",
      "korean_pronunciation": "니고시에이트",
      "meaning": "협상하다, 교섭하다",
      "example_sentence": "Retailers may later negotiate for a share of chatbot profits.",
      "korean_translation": "소매업체들은 나중에 챗봇 수익의 일부를 얻기 위해 협상할 수도 있다.",
      "key_words": ["negotiate"]
    },
    {
      "word": "displace",
      "part_of_speech": "v",
      "korean_pronunciation": "디스플레이스",
      "meaning": "대체하다, 밀어내다",
      "example_sentence": "AI shopping may not fully displace traditional retail.",
      "korean_translation": "AI 쇼핑이 전통적인 소매업을 완전히 대체하지는 않을 것이다.",
      "key_words": ["displace"]
    },
    {
      "word": "consequential",
      "part_of_speech": "adj",
      "korean_pronunciation": "컨시퀀셜",
      "meaning": "중대한, 결과를 초래하는",
      "example_sentence": "Walmart’s partnership with ChatGPT is consequential for the industry.",
      "korean_translation": "Walmart의 ChatGPT 제휴는 업계에 중대한 영향을 미친다.",
      "key_words": ["consequential"]
    },
    {
      "word": "ecosystem",
      "part_of_speech": "n",
      "korean_pronunciation": "에코시스템",
      "meaning": "생태계, 시스템 구조",
      "example_sentence": "Universal AI platforms could reshape the retail ecosystem.",
      "korean_translation": "범용 AI 플랫폼은 소매 산업의 생태계를 재편할 수 있다.",
      "key_words": ["ecosystem"]
    }
  ]
},



    "20250919": {
        "title": "엔비디아 인텔에 투자(20250918)",
        "words": [
            
            {
                "word": "shore up",
                "part_of_speech": "v",
                "korean_pronunciation": "쇼어 업",
                "meaning": "강화하다, 떠받치다",
                "example_sentence": "The investment shores up Intel's struggling finances.",
                "korean_translation": "이 투자는 인텔의 어려운 재정 상황을 안정시킨다.",
                "key_words": ["shores up"]
            },
            {
                "word": "foundry",
                "part_of_speech": "n",
                "korean_pronunciation": "파운드리",
                "meaning": "반도체 위탁 생산 사업",
                "example_sentence": "Intel's foundry ambition faces tough competition from TSMC.",
                "korean_translation": "인텔의 파운드리 야망은 TSMC와의 치열한 경쟁에 직면해 있다.",
                "key_words": ["foundry"]
            },
            {
                "word": "stake",
                "part_of_speech": "n",
                "korean_pronunciation": "스테이크",
                "meaning": "지분, 이해관계",
                "example_sentence": "The U.S. government took a 10% stake in Intel.",
                "korean_translation": "미국 정부는 인텔의 10% 지분을 취득했다.",
                "key_words": ["stake"]
            },
            {
                "word": "premarket",
                "part_of_speech": "adj",
                "korean_pronunciation": "프리마켓",
                "meaning": "장전 거래",
                "example_sentence": "Intel's shares jumped 30% in premarket trading.",
                "korean_translation": "인텔 주가는 장전 거래에서 30% 급등했다.",
                "key_words": ["premarket"]
            },
            {
                "word": "collaboration",
                "part_of_speech": "n",
                "korean_pronunciation": "콜래버레이션",
                "meaning": "협력",
                "example_sentence": "The companies announced a collaboration on new chip designs.",
                "korean_translation": "양사는 새로운 칩 설계에 대한 협력을 발표했다.",
                "key_words": ["collaboration"]
            },
            {
                "word": "revive",
                "part_of_speech": "v",
                "korean_pronunciation": "리바이브",
                "meaning": "되살리다, 회복시키다",
                "example_sentence": "The new deals may revive Intel's weakening position.",
                "korean_translation": "새로운 거래들이 인텔의 약화된 입지를 되살릴 수 있다.",
                "key_words": ["revive"]
            },
            {
                "word": "struggle",
                "part_of_speech": "v",
                "korean_pronunciation": "스트러글",
                "meaning": "고군분투하다",
                "example_sentence": "Intel has been struggling to keep up with rivals.",
                "korean_translation": "인텔은 경쟁사들을 따라잡기 위해 고군분투해 왔다.",
                "key_words": ["struggling"]
            },
            {
                "word": "erode",
                "part_of_speech": "v",
                "korean_pronunciation": "이로드",
                "meaning": "침식하다, 약화시키다",
                "example_sentence": "Intel's delays eroded confidence among investors.",
                "korean_translation": "인텔의 지연은 투자자들의 신뢰를 약화시켰다.",
                "key_words": ["eroded"]
            },
            {
                "word": "boost",
                "part_of_speech": "v",
                "korean_pronunciation": "부스트",
                "meaning": "끌어올리다, 촉진하다",
                "example_sentence": "The government aims to boost Intel's manufacturing capacity.",
                "korean_translation": "정부는 인텔의 제조 역량을 끌어올리려 한다.",
                "key_words": ["boost"]
            },
            
        ]
    }
};

let currentWordIndex = 0;

// 키워드 하이라이트 함수
function highlightKeywords(text, keywords) {
    if (!keywords || keywords.length === 0) return text;
    
    let highlightedText = text;
    keywords.forEach(keyword => {
        const regex = new RegExp(`\\b${keyword}\\b`, 'gi');
        highlightedText = highlightedText.replace(regex, (match) => `<span style="color: red; font-weight: bold;">${match}</span>`);
    });
    return highlightedText;
}

// DOM 요소들
const wordContainer = document.getElementById('article-container');
const wordPopup = document.getElementById('wordPopup');
const popupWord = document.querySelector('.popup-word');
const popupMeaning = document.querySelector('.popup-meaning');
const popupClose = document.querySelector('.popup-close');

// 현재 날짜 설정 (YYYYMMDD 형식)
function getCurrentDate() {
    const now = new Date();
    const year = now.getFullYear();
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const day = String(now.getDate()).padStart(2, '0');
    return `${year}${month}${day}`;
}

// 현재 날짜의 단어들 가져오기
function getWordsForDate(date) {
    return wordsByDate[date]?.words || [];
}

// 현재 날짜의 제목 가져오기
function getTitleForDate(date) {
    return wordsByDate[date]?.title || `뉴스 단어 (${date})`;
}

// 사용 가능한 날짜 목록 가져오기 (최신 날짜부터)
function getAvailableDates() {
    return Object.keys(wordsByDate).sort().reverse();
}

// 모든 단어 표시 (모든 날짜를 아래로 쭉 나열)
function displayAllWords() {
    const availableDates = getAvailableDates();
    let allWordsHTML = '';
    
    availableDates.forEach(date => {
        const words = getWordsForDate(date);
        const title = getTitleForDate(date);
        let wordsText = '';
        
        if (words.length > 0) {
            words.forEach((word, index) => {
                const hasExample = word.example_sentence && word.korean_translation;
                const exampleId = `example-${date}-${index}`;
                const wordId = `word-${date}-${index}`;
                
                const partOfSpeech = word.part_of_speech ? ` <span style="color: #999; font-size: 0.85rem;">(${word.part_of_speech})</span>` : '';
                
                wordsText += `<div class="word-with-underline">
                    <span class="word-number">${index + 1}.</span> 
                    <span class="word-part">${word.meaning}</span> / 
                    <span class="word-part word-hideable" data-date="${date}" id="${wordId}-english">${word.word}${partOfSpeech}</span> / 
                    <span class="word-part word-hideable" data-date="${date}" id="${wordId}-korean">${word.korean_pronunciation}</span>
                    ${hasExample ? ` / <span class="example-toggle" onclick="toggleExample('${exampleId}')" style="color: #007bff; cursor: pointer; text-decoration: underline;">예문</span>` : ''}
                    ${hasExample ? `<div id="${exampleId}" class="example-content" style="display: none; padding-left: 2.0em; margin-top: 8px;">
                        <span class="word-part">${highlightKeywords(word.example_sentence, word.key_words || [])}</span>
                        <br><span class="word-part">(${word.korean_translation})</span>
                    </div>` : ''}
                </div>`;
            });
            
            allWordsHTML += `
                <div class="words-title">
                    ${title}
                    <span id="toggle-all-${date}" onclick="toggleAllExamples('${date}')" style="color: #28a745; cursor: pointer; text-decoration: underline; font-size: 0.95rem; margin-left: 15px; font-weight: 500;">예문 펼치기</span>
                </div>
                <div class="words-text">${wordsText}</div>
                <div class="date-spacing"></div>
            `;
        }
    });
    
    wordContainer.innerHTML = allWordsHTML;
}

// 초기화
function init() {
    console.log("JavaScript가 로드되었습니다!");
    displayAllWords();
}

// 이벤트 리스너 등록
document.addEventListener('DOMContentLoaded', function() {
    // 단어장 초기화
    init();
    
    // Home 링크 클릭 이벤트
    const homeLink = document.querySelector('.nav-link[href="https://englisheasystudy.com/"]');
    if (homeLink) {
        homeLink.addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = 'https://englisheasystudy.com/';
        });
    }
    
    // 팝업 관련 이벤트
    if (popupClose) {
        popupClose.addEventListener('click', closePopup);
    }
    
    // 팝업 외부 클릭 시 닫기
    if (wordPopup) {
        wordPopup.addEventListener('click', function(e) {
            if (e.target === wordPopup) {
                closePopup();
            }
        });
    }
});

// 팝업 닫기
function closePopup() {
    if (wordPopup) {
        wordPopup.style.display = 'none';
    }
}

// 키보드 단축키
document.addEventListener('keydown', function(e) {
    // Escape로 팝업 닫기
    if (e.key === 'Escape') {
        closePopup();
    }
});

// 예문 토글 함수
function toggleExample(exampleId) {
    const exampleElement = document.getElementById(exampleId);
    if (exampleElement) {
        if (exampleElement.style.display === 'none') {
            exampleElement.style.display = 'block';
        } else {
            exampleElement.style.display = 'none';
        }
    }
}

// 단어 숨기기/보이기 토글 함수
function toggleWord(wordId) {
    const englishElement = document.getElementById(`${wordId}-english`);
    const koreanElement = document.getElementById(`${wordId}-korean`);
    
    if (englishElement && koreanElement) {
        if (englishElement.style.display === 'none') {
            // 단어 보이기
            englishElement.style.display = 'inline-block';
            koreanElement.style.display = 'inline-block';
        } else {
            // 단어 숨기기
            englishElement.style.display = 'none';
            koreanElement.style.display = 'none';
        }
    }
}

// 특정 날짜의 모든 단어 숨기기/보이기 토글 함수
function toggleAllWords(date) {
    const allWordsInDate = document.querySelectorAll(`.word-hideable[data-date="${date}"]`);
    
    if (allWordsInDate.length > 0) {
        const firstWord = allWordsInDate[0];
        const isHidden = firstWord.style.backgroundColor === 'white';
        
        allWordsInDate.forEach(wordElement => {
            if (isHidden) {
                // 모든 단어 보이기
                wordElement.style.backgroundColor = 'transparent';
                wordElement.style.color = '#1a1a1a';
            } else {
                // 모든 단어 흰색 배경으로 가리기
                wordElement.style.backgroundColor = 'white';
                wordElement.style.color = 'white';
            }
        });
    }
}

// 특정 날짜의 모든 예문 펼치기/닫기 토글 함수
function toggleAllExamples(date) {
    const allExamplesInDate = document.querySelectorAll(`[id^="example-${date}-"]`);
    const toggleButton = document.getElementById(`toggle-all-${date}`);
    
    if (allExamplesInDate.length > 0) {
        const firstExample = allExamplesInDate[0];
        const isHidden = firstExample.style.display === 'none' || firstExample.style.display === '';
        
        allExamplesInDate.forEach(exampleElement => {
            if (isHidden) {
                // 모든 예문 펼치기
                exampleElement.style.display = 'block';
            } else {
                // 모든 예문 닫기
                exampleElement.style.display = 'none';
            }
        });
        
        // 버튼 텍스트 변경
        if (toggleButton) {
            if (isHidden) {
                toggleButton.textContent = '예문 닫기';
                toggleButton.style.color = '#dc3545';
            } else {
                toggleButton.textContent = '예문 펼치기';
                toggleButton.style.color = '#28a745';
            }
        }
    }
}
